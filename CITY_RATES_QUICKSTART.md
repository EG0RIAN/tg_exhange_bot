# Quick Start - –ö—É—Ä—Å—ã –ø–æ –≥–æ—Ä–æ–¥–∞–º

## üöÄ –ó–∞–ø—É—Å–∫ –∑–∞ 3 —à–∞–≥–∞

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

```bash
docker-compose exec postgres psql -U exchange -d exchange -f /app/migrations/005_city_markups.sql
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è:**
- –°–æ–∑–¥–∞–µ—Ç 7 –ø—Ä–∞–≤–∏–ª –Ω–∞—Ü–µ–Ω–∫–∏ –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤
- –ú–æ—Å–∫–≤–∞ (0%), –°–ü–± (+0.3%), –†–æ—Å—Ç–æ–≤ (+1%), –ù–ù (+0.8%), –ï–∫–± (+0.7%), –ö–∞–∑–∞–Ω—å (+0.9%), –î—Ä—É–≥–∏–µ (+1.5%)

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å webadmin

```bash
docker-compose restart webadmin
```

### –®–∞–≥ 3: –û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω–∫—É

```
http://localhost:8000/admin/city-rates
```

## üìä –ß—Ç–æ –≤—ã —É–≤–∏–¥–∏—Ç–µ

### 1. –¢–∞–±–ª–∏—Ü–∞ –Ω–∞—Ü–µ–Ω–æ–∫
```
–ì–æ—Ä–æ–¥              | –ù–∞—Ü–µ–Ω–∫–∞ | –°—Ç–∞—Ç—É—Å  | –î–µ–π—Å—Ç–≤–∏—è
–ú–æ—Å–∫–≤–∞            | 0%      | –ê–∫—Ç–∏–≤–Ω–æ | [–ò–∑–º–µ–Ω–∏—Ç—å]
–°–ü–±               | +0.3%   | –ê–∫—Ç–∏–≤–Ω–æ | [–ò–∑–º–µ–Ω–∏—Ç—å]
–†–æ—Å—Ç–æ–≤            | +1%     | –ê–∫—Ç–∏–≤–Ω–æ | [–ò–∑–º–µ–Ω–∏—Ç—å]
–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥   | +0.8%   | –ê–∫—Ç–∏–≤–Ω–æ | [–ò–∑–º–µ–Ω–∏—Ç—å]
...
```

### 2. –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –∫—É—Ä—Å–∞–º–∏
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üó∫ –ú–æ—Å–∫–≤–∞        ‚îÇ  ‚îÇ üó∫ –†–æ—Å—Ç–æ–≤        ‚îÇ  ‚îÇ üó∫ –ù.–ù–æ–≤–≥–æ—Ä–æ–¥   ‚îÇ
‚îÇ Ã∂8Ã∂1Ã∂.Ã∂8Ã∂3Ã∂            ‚îÇ  ‚îÇ Ã∂8Ã∂1Ã∂.Ã∂8Ã∂3Ã∂            ‚îÇ  ‚îÇ Ã∂8Ã∂1Ã∂.Ã∂8Ã∂3Ã∂            ‚îÇ
‚îÇ 81.83 ‚ÇΩ         ‚îÇ  ‚îÇ 82.65 ‚ÇΩ         ‚îÇ  ‚îÇ 82.48 ‚ÇΩ         ‚îÇ
‚îÇ [0%]   –ü–æ–∫—É–ø–∫–∞  ‚îÇ  ‚îÇ [+1%]  –ü–æ–∫—É–ø–∫–∞  ‚îÇ  ‚îÇ [+0.8%] –ü–æ–∫—É–ø–∫–∞ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3. –ë–∞–∑–æ–≤—ã–π –∫—É—Ä—Å Rapira
```
Best Ask (–ø–æ–∫—É–ø–∫–∞): 81.83 ‚ÇΩ
Best Bid (–ø—Ä–æ–¥–∞–∂–∞): 81.50 ‚ÇΩ
–°–ø—Ä–µ–¥: 0.40%
```

## ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Ü–µ–Ω–∫—É

### –ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
1. –ù–∞–∂–º–∏—Ç–µ "–ò–∑–º–µ–Ω–∏—Ç—å" –Ω–∞–ø—Ä–æ—Ç–∏–≤ –≥–æ—Ä–æ–¥–∞
2. –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é –Ω–∞—Ü–µ–Ω–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: `1.2` –¥–ª—è +1.2%)
3. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"

### –ß–µ—Ä–µ–∑ SQL:
```sql
-- –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Ü–µ–Ω–∫—É –†–æ—Å—Ç–æ–≤–∞ –Ω–∞ 1.2%
UPDATE fx_markup_rule
SET percent = 1.2
WHERE description ILIKE '%–≥–æ—Ä–æ–¥: rostov%';
```

## üß™ –¢–µ—Å—Ç API

```bash
# –ü–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å –¥–ª—è –†–æ—Å—Ç–æ–≤–∞
curl "http://localhost:8000/api/city-rate/rostov/USDT%2FRUB?operation=buy"

# –ü–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å—ã –¥–ª—è –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤
curl "http://localhost:8000/api/city-rates/all/USDT%2FRUB?operation=buy"

# –ë–∞–∑–æ–≤—ã–π –∫—É—Ä—Å –∏–∑ Rapira
curl "http://localhost:8000/api/rapira/base-rate/USDT%2FRUB"

# –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Ü–µ–Ω–∫—É (–Ω—É–∂–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
curl -X POST "http://localhost:8000/api/city-rates/update-markup" \
  -d "city=rostov&percent=1.2"
```

## üìç –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –±–æ—Ç–∞

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ö–µ–Ω–¥–ª–µ—Ä–µ:

```python
from src.services.rapira_simple import get_city_rate

@router.message(Command("rate"))
async def cmd_rate(message: types.Message):
    # –ü–æ–ª—É—á–∞–µ–º –≥–æ—Ä–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ –ë–î –∏–ª–∏ FSM)
    user_city = "rostov"  # –ù–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
    
    # –ü–æ–ª—É—á–∞–µ–º –∫—É—Ä—Å
    rate = await get_city_rate("USDT/RUB", user_city, "buy")
    
    if rate:
        await message.answer(
            f"üí∞ –ö—É—Ä—Å USDT/RUB –¥–ª—è {user_city}:\n"
            f"–ë–∞–∑–æ–≤—ã–π: {rate['base_rate']:.2f} ‚ÇΩ\n"
            f"–ù–∞—Ü–µ–Ω–∫–∞: +{rate['markup_percent']}%\n"
            f"**–ò—Ç–æ–≥–æ: {rate['final_rate']:.2f} ‚ÇΩ**"
        )
```

## üéØ –î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥ –≤ –±–æ—Ç

### 1. –°–æ–∑–¥–∞—Ç—å FSM –¥–ª—è –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞

```python
class OrderFSM(StatesGroup):
    choosing_city = State()
    choosing_amount = State()

@router.message(Command("order"))
async def start_order(message: types.Message, state: FSMContext):
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –≥–æ—Ä–æ–¥–∞–º–∏
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üèõ –ú–æ—Å–∫–≤–∞", callback_data="city:moscow")],
        [InlineKeyboardButton(text="üåâ –°–ü–±", callback_data="city:spb")],
        [InlineKeyboardButton(text="üè≠ –†–æ—Å—Ç–æ–≤", callback_data="city:rostov")],
        [InlineKeyboardButton(text="üè∞ –ù.–ù–æ–≤–≥–æ—Ä–æ–¥", callback_data="city:nizhniy_novgorod")],
    ])
    
    await message.answer("–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –≥–æ—Ä–æ–¥:", reply_markup=keyboard)
    await state.set_state(OrderFSM.choosing_city)

@router.callback_query(lambda c: c.data.startswith("city:"))
async def process_city(callback: types.CallbackQuery, state: FSMContext):
    city = callback.data.split(":")[1]
    await state.update_data(city=city)
    
    # –ü–æ–ª—É—á–∞–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—É—Ä—Å
    rate = await get_city_rate("USDT/RUB", city, "buy")
    
    await callback.message.edit_text(
        f"‚úÖ –ì–æ—Ä–æ–¥: {CITIES[city]}\n"
        f"üí∞ –ö—É—Ä—Å: {rate['final_rate']:.2f} ‚ÇΩ\n\n"
        f"–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É:"
    )
    await state.set_state(OrderFSM.choosing_amount)
```

## üìã –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫

### –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ (—Å–ª–æ–∂–Ω–∞—è):
```python
# Rapira API ‚Üí VWAP —Ä–∞—Å—á–µ—Ç—ã ‚Üí –°–ø—Ä–µ–¥—ã ‚Üí –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ ‚Üí –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
# –ú–Ω–æ–≥–æ —à–∞–≥–æ–≤, —Å–ª–æ–∂–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

### –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (–ø—Ä–æ—Å—Ç–∞—è):
```python
# Rapira API ‚Üí –ù–∞—Ü–µ–Ω–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É ‚Üí –ì–æ—Ç–æ–≤–æ!
# –û–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ (Rapira) ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞—Ü–µ–Ω–æ–∫ –≤ –∞–¥–º–∏–Ω–∫–µ ‚Üí –í—Å–µ –≥–æ—Ä–æ–¥–∞ –ø–æ–ª—É—á–∞—é—Ç —Å–≤–æ–∏ –∫—É—Ä—Å—ã
```

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ **–ü—Ä–æ—Å—Ç–æ**: –û–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ (Rapira), –æ–¥–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞
- ‚úÖ **–ì–∏–±–∫–æ**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞—Ü–µ–Ω–∫–∏ –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞ –≤ 1 –∫–ª–∏–∫
- ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ**: –í–∏–¥–Ω–æ –±–∞–∑–æ–≤—ã–π –∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫—É—Ä—Å
- ‚úÖ **–ë—ã—Å—Ç—Ä–æ**: –ù–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π, –ø—Ä—è–º–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Ü–µ–Ω–∫–∏
- ‚úÖ **–£–¥–æ–±–Ω–æ**: Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## üé¨ –î–µ–º–æ

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000/admin
2. –ù–∞–∂–º–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É "üìç –ö—É—Ä—Å—ã –ø–æ –≥–æ—Ä–æ–¥–∞–º"
3. –£–≤–∏–¥–∏—Ç–µ –≤—Å–µ –∫—É—Ä—Å—ã —Å –Ω–∞—Ü–µ–Ω–∫–∞–º–∏
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Ü–µ–Ω–∫—É –¥–ª—è –ª—é–±–æ–≥–æ –≥–æ—Ä–æ–¥–∞
5. –ö—É—Ä—Å –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

**–í–æ—Ç –∏ –≤—Å—ë!** üéâ

–û–¥–∏–Ω –ø–∞—Ä—Å–µ—Ä Rapira ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞—Ü–µ–Ω–æ–∫ –≤ –∞–¥–º–∏–Ω–∫–µ ‚Üí –ö—É—Ä—Å—ã –¥–ª—è –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤ –≥–æ—Ç–æ–≤—ã!

