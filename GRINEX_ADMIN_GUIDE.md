# Grinex Admin Guide - ะฃะฟัะฐะฒะปะตะฝะธะต ะฒ ะฑะพัะต

## ๐ฏ ะัััััะน ะดะพัััะฟ

### ะงะตัะตะท ะฐะดะผะธะฝ-ะฟะฐะฝะตะปั
1. ะัะฟัะฐะฒััะต `/admin` ะฒ ะฑะพั
2. ะะฐะถะผะธัะต "๐ ะะฝัะตะณัะฐัะธะธ"
3. ะัะฑะตัะธัะต "๐ข Grinex Exchange"

### ะััะผัะต ะบะพะผะฐะฝะดั
- `/grinex_status` - ะกัะฐััั ะธะฝัะตะณัะฐัะธะธ
- `/grinex_ticker` - ะะพะปััะธัั ะบะพะฝะบัะตัะฝัะน ัะธะบะตั
- `/grinex_help` - ะกะฟัะฐะฒะบะฐ

## ๐ ะะพะผะฐะฝะดะฐ `/grinex_status`

ะะพะบะฐะทัะฒะฐะตั:
- โ ะกัะฐััั Grinex API (ะฐะบัะธะฒะตะฝ/ะฝะตะดะพัััะฟะตะฝ)
- โฑ ะะฐะดะตัะถะบะฐ (latency) ะฒ ะผะธะปะปะธัะตะบัะฝะดะฐั
- ๐ข HTTP ะบะพะด ะฟะพัะปะตะดะฝะตะณะพ ะพัะฒะตัะฐ
- ๐ ะัะตะผั ะฟะพัะปะตะดะฝะตะณะพ ะพะฑะฝะพะฒะปะตะฝะธั
- โ ะะพะปะธัะตััะฒะพ ะพัะธะฑะพะบ
- ๐ ะะพัะปะตะดะฝัั ัะธะฝััะพะฝะธะทะฐัะธั FX
- โ๏ธ ะะฝัะตัะฒะฐะป ะพะฑะฝะพะฒะปะตะฝะธั ะบัััะพะฒ

### ะะพัััะฟะฝัะต ะบะฝะพะฟะบะธ:

#### ๐ ะกะธะฝััะพะฝะธะทะธัะพะฒะฐัั
- ะัะธะฝัะดะธัะตะปัะฝะพ ะทะฐะฟััะบะฐะตั ัะธะฝััะพะฝะธะทะฐัะธั ะบัััะพะฒ ะธะท Grinex
- ะะพะบะฐะทัะฒะฐะตั ัะตะทัะปััะฐั:
  - ะะฑัะฐะฑะพัะฐะฝะพ ะฟะฐั
  - ะฃัะฟะตัะฝะพ ัะธะฝััะพะฝะธะทะธัะพะฒะฐะฝะพ
  - ะะพะปะธัะตััะฒะพ ะพัะธะฑะพะบ
  - ะะปะธัะตะปัะฝะพััั ะพะฟะตัะฐัะธะธ

#### ๐ ะัััั
- ะะพะบะฐะทัะฒะฐะตั ัะตะบััะธะต ะบัััั ะธะท Grinex ั ะฝะฐัะตะฝะบะฐะผะธ
- ะะปั ะบะฐะถะดะพะน ะฟะฐัั ะพัะพะฑัะฐะถะฐะตััั:
  - ๐ข/๐ก ะกัะฐััั (ะฐะบััะฐะปัะฝัะต/ัััะฐัะตะฒัะธะต)
  - Raw price (ัััะฐั ัะตะฝะฐ)
  - Final price (ัะธะฝะฐะปัะฝะฐั ัะตะฝะฐ ั ะฝะฐัะตะฝะบะพะน)
  - ะัะพัะตะฝั ะธ ัะธะบัะธัะพะฒะฐะฝะฝะฐั ะฝะฐัะตะฝะบะฐ
  - ะัะตะผั ะฟะพัะปะตะดะฝะตะณะพ ะพะฑะฝะพะฒะปะตะฝะธั

#### ๐ ะขะธะบะตัั
- ะะพะบะฐะทัะฒะฐะตั raw ัะธะบะตัั ะฟััะผะพ ะธะท API Grinex
- ะัะพะฑัะฐะถะฐะตั:
  - ะขะตะบััะฐั ัะตะฝะฐ (last_price)
  - Bid/Ask ัะฟัะตะด
  - ะะฑัะตะผ ะทะฐ 24 ัะฐัะฐ
  - ะะทะผะตะฝะตะฝะธะต ัะตะฝั ะทะฐ 24 ัะฐัะฐ
  - ๐ข/๐ด ะะฐะฟัะฐะฒะปะตะฝะธะต ะธะทะผะตะฝะตะฝะธั

#### ๐งช ะขะตัั API
- ะะฐะฟััะบะฐะตั ะบะพะผะฟะปะตะบัะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต:
  1. โ get_ticker('USDTRUB') - ะฟะพะปััะตะฝะธะต ะพะดะฝะพะณะพ ัะธะบะตัะฐ
  2. โ get_all_tickers() - ะฟะพะปััะตะฝะธะต ะฒัะตั ัะธะบะตัะพะฒ
  3. โ Health check - ะฟัะพะฒะตัะบะฐ ัะพััะพัะฝะธั
  4. โ FX sync - ัะตัั ัะธะฝััะพะฝะธะทะฐัะธะธ ัะตัะตะท FX ัะตัะฒะธั
- ะะพะบะฐะทัะฒะฐะตั latency ะธ timestamp

#### โ๏ธ ะะฐัััะพะนะบะธ
- ะะพะบะฐะทัะฒะฐะตั ะบะพะฝัะธะณััะฐัะธั Grinex:
  - Base URL API
  - Timeout ะทะฐะฟัะพัะพะฒ
  - Max retries
  - FX ะฟะปะฐะฝะธัะพะฒัะธะบ ะฝะฐัััะพะนะบะธ
- ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะบะฝะพะฟะบะธ:
  - ๐ ะกัะฐัะธััะธะบะฐ ะฟะฐั
  - ๐ ะะปะฐะฝะธัะพะฒัะธะบ

## ๐ ะะพะผะฐะฝะดะฐ `/grinex_ticker`

ะะพะปััะฐะตั ะดะตัะฐะปัะฝัั ะธะฝัะพัะผะฐัะธั ะฟะพ ะบะพะฝะบัะตัะฝะพะผั ัะธะบะตัั:

**ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั:**
1. ะัะฟัะฐะฒััะต `/grinex_ticker`
2. ะะฒะตะดะธัะต ัะธะผะฒะพะป ะฟะฐัั: `USDTRUB` ะธะปะธ `BTCUSDT`

**ะัะพะฑัะฐะถะฐะตะผะฐั ะธะฝัะพัะผะฐัะธั:**
- ๐ฐ Price (ัะตะบััะฐั ัะตะฝะฐ)
- ๐ Bid/Ask + ัะฟัะตะด
- ๐ Volume 24h
- ๐ High/Low 24h
- ๐ Change 24h (ั ะธะฝะดะธะบะฐัะพัะพะผ ๐ข/๐ด)
- ๐ Timestamp

## ๐ง ะะฐัััะพะนะบะฐ ะธััะพัะฝะธะบะฐ

### ะงะตัะตะท Web Admin
```
http://localhost:8000/admin/fx/sources
```
- ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะฐัะฐะผะธ
- ะัะพัะผะพัั raw ะดะฐะฝะฝัั
- ะัะธะฝัะดะธัะตะปัะฝะฐั ัะธะฝััะพะฝะธะทะฐัะธั

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะน ะฟะฐัั (SQL)
```sql
INSERT INTO fx_source_pair (source_id, source_symbol, base_currency, quote_currency, internal_symbol, enabled)
SELECT id, 'ETHRUB', 'ETH', 'RUB', 'ETH/RUB', true
FROM fx_source WHERE code = 'grinex';
```

### ะะฐัััะพะนะบะฐ ะฝะฐัะตะฝะบะธ ะดะปั Grinex

**ะะปะพะฑะฐะปัะฝะพ ะดะปั ะฒัะตะณะพ Grinex (+1.5%):**
```sql
INSERT INTO fx_markup_rule (level, source_id, percent, fixed, enabled, description)
SELECT 'source', id, 1.5, 0, true, 'Grinex: 1.5% markup'
FROM fx_source WHERE code = 'grinex';
```

**ะะปั ะบะพะฝะบัะตัะฝะพะน ะฟะฐัั (+2% + 10 RUB):**
```sql
INSERT INTO fx_markup_rule (level, source_id, source_pair_id, percent, fixed, enabled, description)
SELECT 'pair', sp.source_id, sp.id, 2.0, 10.0, true, 'USDT/RUB special markup'
FROM fx_source_pair sp
JOIN fx_source s ON s.id = sp.source_id
WHERE s.code = 'grinex' AND sp.internal_symbol = 'USDT/RUB';
```

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั
```bash
# ะงะตัะตะท API
curl http://localhost:8000/api/fx/scheduler/status

# ะงะตัะตะท ะฑะพั
/grinex_status โ ๐งช ะขะตัั API
```

### ะะพะณะธ
```bash
# Docker ะปะพะณะธ
docker-compose logs bot | grep -i grinex

# ะะพะณะธ ัะธะฝััะพะฝะธะทะฐัะธะธ
docker-compose logs bot | grep "FX sync.*grinex"

# ะัะธะฑะบะธ
docker-compose logs bot | grep -i "grinex.*error"
```

### ะะตััะธะบะธ
ะ `/grinex_status` ะพัะพะฑัะฐะถะฐัััั:
- Latency (ะทะฐะดะตัะถะบะฐ API)
- Error count (ะบะพะปะธัะตััะฒะพ ะพัะธะฑะพะบ)
- Last update (ะฒัะตะผั ะฟะพัะปะตะดะฝะตะณะพ ะพะฑะฝะพะฒะปะตะฝะธั)
- HTTP code (ะบะพะด ะฟะพัะปะตะดะฝะตะณะพ ะพัะฒะตัะฐ)

## ๐ Troubleshooting

### ะัััั ะฝะต ะพะฑะฝะพะฒะปััััั
1. ะัะพะฒะตัะธัั `/grinex_status` - ัะผะพััะธะผ ััะฐััั API
2. ะะฐะถะฐัั "๐งช ะขะตัั API" - ะฟัะพะฒะตััะตะผ ะดะพัััะฟะฝะพััั
3. ะะฐะถะฐัั "๐ ะกะธะฝััะพะฝะธะทะธัะพะฒะฐัั" - ะฟัะธะฝัะดะธัะตะปัะฝะพ ะพะฑะฝะพะฒะธัั
4. ะัะพะฒะตัะธัั ะปะพะณะธ: `docker-compose logs bot | grep grinex`

### API ะฝะตะดะพัััะฟะตะฝ (๐ด)
1. ะัะพะฒะตัะธัั GRINEX_API_BASE ะฒ .env
2. ะัะพะฒะตัะธัั ัะตัะตะฒัั ะดะพัััะฟะฝะพััั
3. ะฃะฒะตะปะธัะธัั GRINEX_TIMEOUT
4. ะัะพะฒะตัะธัั ะปะพะณะธ ะฝะฐ ะดะตัะฐะปะธ ะพัะธะฑะพะบ

### ะฃััะฐัะตะฒัะธะต ะดะฐะฝะฝัะต (๐ก stale)
- ะะฐะฝะฝัะต ััะฐััะต FX_STALE_THRESHOLD_SECONDS
- ะัะพะฒะตัะธัั ัะฐะฑะพัั ะฟะปะฐะฝะธัะพะฒัะธะบะฐ: `/grinex_status` โ โ๏ธ ะะฐัััะพะนะบะธ โ ๐ ะะปะฐะฝะธัะพะฒัะธะบ
- ะัะธะฝัะดะธัะตะปัะฝะพ ัะธะฝััะพะฝะธะทะธัะพะฒะฐัั

### ะะตะฟัะฐะฒะธะปัะฝะฐั ะฝะฐัะตะฝะบะฐ
1. ะัะพะฒะตัะธัั Web Admin: http://localhost:8000/admin/fx/markup-rules
2. ะฃะฑะตะดะธัััั ััะพ ะฟัะฐะฒะธะปะพ enabled = true
3. ะัะพะฒะตัะธัั ะฟัะธะพัะธัะตั: Pair > Source > Global
4. ะคะพัะผัะปะฐ: `price1 = raw * (1 + percent/100); final = price1 + fixed`

## ๐ Web Admin vs Bot

| ะคัะฝะบัะธั | Bot | Web Admin |
|---------|-----|-----------|
| ะกัะฐััั API | โ `/grinex_status` | โ /admin/fx/sources |
| ะกะธะฝััะพะฝะธะทะฐัะธั | โ ะะฝะพะฟะบะฐ "๐" | โ ะะฝะพะฟะบะฐ "Sync Now" |
| ะัะพัะผะพัั ะบัััะพะฒ | โ ะะฝะพะฟะบะฐ "๐" | โ /admin/fx/rates |
| ะัะพัะผะพัั ัะธะบะตัะพะฒ | โ ะะฝะพะฟะบะฐ "๐" | โ |
| ะขะตัั API | โ ะะฝะพะฟะบะฐ "๐งช" | โ |
| ะะฐัััะพะนะบะฐ ะฟะฐั | โ | โ /admin/fx/sources/{id}/pairs |
| ะัะฐะฒะธะปะฐ ะฝะฐัะตะฝะบะธ | โ | โ /admin/fx/markup-rules |
| ะะพะณะธ ัะธะฝััะพะฝะธะทะฐัะธะธ | โ | โ /admin/fx/logs |

## ๐ ะกะฒัะทะฐะฝะฝัะต ะบะพะผะฐะฝะดั

- `/rapira_status` - ะะฝะฐะปะพะณะธัะฝะฐั ะฟะฐะฝะตะปั ะดะปั Rapira
- `/admin` โ "๐ ะะฝัะตะณัะฐัะธะธ" โ "๐ FX Rates System" - ะะฑัะธะน ััะฐััั FX
- Web Admin: http://localhost:8000/admin/fx/sources

## ๐ ะะพัััะฟ

ะัะต ะบะพะผะฐะฝะดั ะดะพัััะฟะฝั ัะพะปัะบะพ ะฐะดะผะธะฝะธัััะฐัะพัะฐะผ (ADMIN_IDS ะฒ .env).

---

**ะะพะบัะผะตะฝัะฐัะธั:**
- ะะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ: `FX_RATES_README.md`
- ะะตัะฐะปะธ ัะตะฐะปะธะทะฐัะธะธ: `FX_IMPLEMENTATION_SUMMARY.md`
- ะัััััะน ััะฐัั: `QUICK_START_FX.md`

