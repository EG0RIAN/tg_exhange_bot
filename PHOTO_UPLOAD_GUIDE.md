# üì∏ –ó–∞–≥—Ä—É–∑–∫–∞ –§–æ—Ç–æ/–î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –ó–∞—è–≤–∫–∏

## ‚ú® –ù–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å —Ñ–æ—Ç–æ –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∫ –∑–∞—è–≤–∫–∞–º –Ω–∞ –ø–æ–∫—É–ø–∫—É/–ø—Ä–æ–¥–∞–∂—É USDT. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —ç—Ç–∏ —Ñ–∞–π–ª—ã –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –¥–ª—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü–æ–∫—É–ø–∫–∞/–ü—Ä–æ–¥–∞–∂–∞ USDT

1. **–í—ã–±–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏**: üíµ –ö—É–ø–∏—Ç—å USDT –∏–ª–∏ üí∏ –ü—Ä–æ–¥–∞—Ç—å USDT
2. **–í–≤–æ–¥ —Å—É–º–º—ã**: –£–∫–∞–∑–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ USDT
3. **–í—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞**: –í—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥ –∏–∑ —Å–ø–∏—Å–∫–∞
4. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫—É—Ä—Å–∞**: –°–æ–≥–ª–∞—Å–∏—Ç—å—Å—è —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–º –∫—É—Ä—Å–æ–º
5. **–í—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã**: –£–∫–∞–∑–∞—Ç—å –≤–∞–ª—é—Ç—É (RUB, USD, EUR –∏ —Ç.–ø.)
6. **–í–≤–æ–¥ username**: –£–∫–∞–∑–∞—Ç—å —Ç–µ–ª–µ–≥—Ä–∞–º @username
7. **üì∏ –ù–û–í–û–ï: –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ**
   - –ë–æ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç
   - –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å:
     - **–§–æ—Ç–æ** (—Å–∫—Ä–∏–Ω—à–æ—Ç, —á–µ–∫ –∏ —Ç.–ø.)
     - **–î–æ–∫—É–º–µ–Ω—Ç** (PDF, –∫–≤–∏—Ç–∞–Ω—Ü–∏—è –∏ —Ç.–ø.)
   - –ú–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å: `/skip`
8. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞—è–≤–∫—É

---

## üë®‚Äçüíº –ü—Ä–æ—Å–º–æ—Ç—Ä –≤ –ê–¥–º–∏–Ω–∫–µ

### –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. –í–æ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É: `http://–í–ê–®_–î–û–ú–ï–ù:8000/admin`
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª **"–ó–∞—è–≤–∫–∏"**
3. –û—Ç–∫—Ä—ã—Ç—å –Ω—É–∂–Ω—É—é –∑–∞—è–≤–∫—É
4. –ï—Å–ª–∏ —Ñ–∞–π–ª –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω, –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
üì∑ –§–æ—Ç–æ/–î–æ–∫—É–º–µ–Ω—Ç: –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω (photo)  [üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä]
```

5. –ù–∞–∂–∞—Ç—å **"–ü—Ä–æ—Å–º–æ—Ç—Ä"** –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–∞ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ

### –¢–∏–ø—ã —Ñ–∞–π–ª–æ–≤

- **photo** - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (JPG, PNG)
- **document** - –¥–æ–∫—É–º–µ–Ω—Ç (PDF, DOC –∏ —Ç.–ø.)

---

## üóÑÔ∏è –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `orders`

```sql
photo_file_id VARCHAR(255)  -- Telegram file_id
photo_file_type VARCHAR(20)  -- 'photo' –∏–ª–∏ 'document'
```

### –ú–∏–≥—Ä–∞—Ü–∏—è

–§–∞–π–ª: `migrations/012_add_photo_fields.sql`

```sql
ALTER TABLE orders ADD COLUMN IF NOT EXISTS photo_file_id VARCHAR(255);
ALTER TABLE orders ADD COLUMN IF NOT EXISTS photo_file_type VARCHAR(20);
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –î–µ—Ç–∞–ª–∏

### FSM –°–æ—Å—Ç–æ—è–Ω–∏—è

–î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `attach_photo` –≤:
- `BuyUSDTStates`
- `SellUSDTStates`

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

**buy_usdt.py** –∏ **sell_usdt.py**:

```python
@router.message(BuyUSDTStates.attach_photo, F.document | F.photo)
async def attach_photo_file(message: Message, state: FSMContext):
    """–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞"""
    if message.document:
        file_id = message.document.file_id
        file_type = "document"
    elif message.photo:
        file_id = message.photo[-1].file_id
        file_type = "photo"
    
    await state.update_data(photo_file_id=file_id, photo_file_type=file_type)
    await show_confirmation(message, state)

@router.message(BuyUSDTStates.attach_photo, Command("skip"))
async def skip_photo(message: Message, state: FSMContext):
    """–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ"""
    await show_confirmation(message, state)
```

### API –≠–Ω–¥–ø–æ–∏–Ω—Ç

**GET** `/admin/orders/{order_id}/photo`

- –ü–æ–ª—É—á–∞–µ—Ç `photo_file_id` –∏–∑ –ë–î
- –°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª —á–µ—Ä–µ–∑ Telegram Bot API
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∞–π–ª —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º MIME-—Ç–∏–ø–æ–º
- –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç —á–µ–∫

```
–ë–æ—Ç: üì∏ –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç:
     –ù–∞–ø—Ä–∏–º–µ—Ä: —á–µ–∫, –∫–≤–∏—Ç–∞–Ω—Ü–∏—é –∏–ª–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç
     üí° –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å, –Ω–∞–∂–º–∏—Ç–µ /skip

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ —á–µ–∫–∞]

–ë–æ—Ç: ‚úÖ –§–æ—Ç–æ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ
     üìã –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à—É –∑–∞—è–≤–∫—É:
     ...
```

### 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç

```
–ë–æ—Ç: üì∏ –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç:
     –ù–∞–ø—Ä–∏–º–µ—Ä: —á–µ–∫, –∫–≤–∏—Ç–∞–Ω—Ü–∏—é –∏–ª–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç
     üí° –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å, –Ω–∞–∂–º–∏—Ç–µ /skip

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /skip

–ë–æ—Ç: üìã –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à—É –∑–∞—è–≤–∫—É:
     ...
```

### 3. –ê–¥–º–∏–Ω –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Ñ–æ—Ç–æ

```
–ê–¥–º–∏–Ω–∫–∞ ‚Üí –ó–∞—è–≤–∫–∏ ‚Üí –ó–∞—è–≤–∫–∞ #123
üì∑ –§–æ—Ç–æ/–î–æ–∫—É–º–µ–Ω—Ç: –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω (photo)  [üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä]

[–ö–ª–∏–∫ –Ω–∞ "–ü—Ä–æ—Å–º–æ—Ç—Ä"]
‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ñ–æ—Ç–æ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
```

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –£–¥–æ–±–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- **–î–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤**: –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- **–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫
- **–ì–∏–±–∫–æ—Å—Ç—å**: –ú–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–æ

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö Telegram
- –í –ë–î —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ `file_id`
- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –∞–¥–º–∏–Ω–∞–º
- –§–∞–π–ª—ã –Ω–µ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

---

## üéØ –ß—Ç–æ –¥–∞–ª—å—à–µ?

–í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- [ ] –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ)
- [ ] –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ –ø—Ä—è–º–æ –≤ —Å–ø–∏—Å–∫–µ –∑–∞—è–≤–æ–∫
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞/—Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
- [ ] –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- [ ] –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ N –¥–Ω–µ–π

---

## üìù Changelog

**2025-10-19**: –ü–µ—Ä–≤—ã–π —Ä–µ–ª–∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ/–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –≤ –∞–¥–º–∏–Ω–∫–µ
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π

